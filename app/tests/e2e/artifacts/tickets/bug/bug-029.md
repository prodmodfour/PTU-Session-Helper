---
ticket_id: bug-029
priority: P3
status: open
domain: api-validation
source: code-review-079
created_at: 2026-02-20
created_by: senior-reviewer
---

## Summary

Character PUT endpoint accepts `boundAp`, `drainedAp`, and `currentAp` fields without input validation. Negative values, non-integers, or values exceeding `maxAp` could corrupt state.

## Expected Behavior

AP fields should be validated: `>= 0`, integer, and ideally `<= maxAp` (derived from character level).

## Actual Behavior

`PUT /api/characters/:id` passes `body.boundAp`, `body.drainedAp`, and `body.currentAp` directly to Prisma without any bounds checking.

## Files to Change

- `app/server/api/characters/[id].put.ts` -- add `Math.max(0, Math.floor(...))` clamping for all AP fields at minimum

## Notes

This is a low-priority issue since the endpoint is GM-only and unlikely to receive malformed input in normal usage. However, defensive validation prevents hard-to-debug state corruption.
