---
ticket_id: bug-003
type: bug
priority: P1
status: resolved
source_ecosystem: dev
target_ecosystem: dev
created_by: game-logic-reviewer
created_at: 2026-02-18T22:35:00
domain: pokemon-generation
severity: HIGH
affected_files:
  - app/server/services/pokemon-generator.service.ts
---

## Summary

The `other` → `otherCapabilities` key rename in capabilities JSON (commit f18ccf3) has no data migration. Existing Pokemon records in the database still have `"other": [...]` in their capabilities JSON, but all code now reads `"otherCapabilities"`. This silently hides Naturewalk, Underdog, Mountable, and all other non-movement capabilities for every previously-created Pokemon.

## Details

**Before (commit f18ccf3):**
```javascript
capabilities: JSON.stringify({
  ...data.movementCaps,
  other: data.otherCapabilities,
  size: data.size
})
```

**After:**
```javascript
capabilities: JSON.stringify({
  ...data.movementCaps,
  power: data.power,
  jump: data.jump,
  weightClass: data.weightClass,
  size: data.size,
  otherCapabilities: data.otherCapabilities
})
```

The UI (`PokemonCapabilitiesTab.vue:42`) reads `capabilities?.otherCapabilities?.length` — returns `undefined` for existing records that have the old `"other"` key.

## Impact

Every Pokemon created before commit f18ccf3 loses its "Other Capabilities" display (Naturewalk, Underdog, Mountable, Reach, Glow, Heater, Firestarter, etc.). The data still exists in the JSON but is keyed under `"other"` while code reads `"otherCapabilities"`.

## Suggested Fix

One-time SQL migration to rename the key in all existing capabilities JSON:

```sql
UPDATE Pokemon
SET capabilities = REPLACE(capabilities, '"other":', '"otherCapabilities":')
WHERE capabilities LIKE '%"other":%';
```

Alternatively, add a Prisma migration script or handle both keys at read time.

## Source

Found during rules-review-032 (review of refactoring-036/037). Introduced by commit f18ccf3.

## Fix Log

- **Commit:** 9a7cca5
- **Fix:** One-time migration script (`app/prisma/migrate-capabilities-key.ts`) using `SQL REPLACE` to rename `"other":` → `"otherCapabilities":` in all Pokemon capabilities JSON
- **Records migrated:** 88
- **Verification:** Post-migration query confirmed 0 records with old key remain
- **Related:** Also closes refactoring-038 (same issue)
